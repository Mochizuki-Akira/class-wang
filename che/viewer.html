<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>è¬›ç¾©ãƒ•ã‚¡ã‚¤ãƒ«é–²è¦§ï½œå­¦ç¿’å°å±‹</title>
  <link rel="stylesheet" href="../common/style.css" />
  <style>
    html, body { height:100%; width:100%; margin:0; background:#000; overflow:hidden; user-select:none; }
    .viewer-box { position:fixed; inset:0; background:#2b2b2b; }
    .pdf-embed, .pdf-object {
      position:absolute; inset:0; width:100vw; height:100vh; border:none; background:#fff;
    }
    .overlay-controls { position:fixed; top:14px; left:14px; z-index:20; display:flex; gap:10px; }
    .btn-outline-sm { padding:8px 16px; font-size:0.95rem; border-radius:10px; }
    .fallback {
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      z-index:15; background:rgba(0,0,0,0.6); color:#fff; text-align:center; padding:24px;
    }
    .fallback .actions { margin-top:16px; display:flex; gap:12px; justify-content:center; flex-wrap:wrap; }
  </style>
</head>
<body>
  <!-- å·¦ä¸Šè§’è¿”å› -->
  <div class="overlay-controls">
    <a href="./lectures.html" class="btn-outline btn-outline-sm">â† ãƒ‘ã‚¹ã‚²ãƒ¼ãƒˆã¸æˆ»ã‚‹</a>
  </div>

  <div class="viewer-box">
    <!-- æ–¹æ¡ˆAï¼šobjectï¼ˆå¾ˆå¤šæµè§ˆå™¨å¯¹ PDF æ›´å‹å¥½ï¼‰ -->
    <object id="pdfObj" class="pdf-object" type="application/pdf" data="" aria-label="PDF viewer">
      <!-- æ–¹æ¡ˆBï¼šembed ä½œä¸º object çš„å†…éƒ¨åå¤‡ -->
      <embed id="pdfEmbed" class="pdf-embed" type="application/pdf" src="" />
    </object>
  </div>

  <!-- åŠ è½½å¤±è´¥æ—¶çš„é™çº§æç¤ºï¼ˆæä¾›ç›´é“¾æ‰“å¼€ï¼‰ -->
  <div id="fallback" class="fallback">
    <div>
      <div style="font-size:1.05rem;">å†…åµŒãƒ“ãƒ¥ãƒ¼ã‚¢ã§ã®è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸã€‚</div>
      <div class="actions">
        <a id="openDirect" class="btn-outline btn-outline-sm">ğŸ“„ ç›´æ¥é–‹ã</a>
        <a href="./lectures.html" class="btn-outline btn-outline-sm">â† ãƒ‘ã‚¹ã‚²ãƒ¼ãƒˆã¸æˆ»ã‚‹</a>
      </div>
      <div class="text-muted" style="margin-top:10px; font-size:0.9rem;">â€» ä¸€éƒ¨ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ PDF ã®åŸ‹ã‚è¾¼ã¿ãŒåˆ¶é™ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</div>
    </div>
  </div>

  <script>
    // ===== æ˜ å°„è¡¨ï¼ˆæ³¨æ„ï¼šç›¸å¯¹ viewer.html çš„è·¯å¾„ï¼›viewer ä½äº /che/ ä¸‹ï¼‰=====
    const FILES = {
      '2507_1': 'assets/lectures/2507/chem_1.pdf',
      '2507_2': 'assets/lectures/2507/chem_2.pdf',
      '2507_3': 'assets/lectures/2507/chem_3.pdf',
      '2510_1': 'assets/lectures/2510/chem_1.pdf',
      '2510_2': 'assets/lectures/2510/chem_2.pdf',
      '2510_3': 'assets/lectures/2510/chem_3.pdf'
    };

    const params = new URLSearchParams(location.search);
    const id = params.get('id');
    const path = FILES[id];

    const obj = document.getElementById('pdfObj');
    const emb = document.getElementById('pdfEmbed');
    const fb  = document.getElementById('fallback');
    const openDirect = document.getElementById('openDirect');

    function showFallback(url) {
      fb.style.display = 'flex';
      openDirect.href = url;
      openDirect.target = '_self'; // åŒé¡µæ‰“å¼€
    }

    if (!path) {
      showFallback('./lectures.html');
    } else {
      document.title = `è¬›ç¾©ãƒ•ã‚¡ã‚¤ãƒ« (${id})ï½œå­¦ç¿’å°å±‹`;
      // å…ˆå°è¯• objectï¼Œå†ç”± embed å…œåº•
      obj.setAttribute('data', path);
      emb.setAttribute('src', path);

      // ç®€å•çš„å¯è§æ€§æ£€æµ‹ï¼šåŠ è½½åè‹¥ä»æ˜¯ç©ºç™½ï¼Œæ˜¾ç¤ºé™çº§
      // Safari/iOS æœ‰æ—¶éœ€è¦ç”¨æˆ·äº¤äº’åæ‰æ¸²æŸ“ï¼Œè¿™é‡Œç»™ 800ms ç¼“å†²
      setTimeout(() => {
        // å¦‚æœ object æ— æ³•æ¸²æŸ“ï¼Œé€šå¸¸ contentDocument ä¸ºç©ºä¸”å°ºå¯¸éé›¶ä½†çœ‹ä¸åˆ°å†…å®¹
        // æˆ‘ä»¬ç”¨ä¸€ä¸ªè¶…ä¿å®ˆé™çº§ï¼šæä¾›ç›´é“¾æŒ‰é’®
        const url = path;
        // æ— æ³•å¯é æ£€æµ‹æ‰€æœ‰æµè§ˆå™¨çš„â€œç©ºç™½â€çŠ¶æ€ï¼Œç»Ÿä¸€ç»™ä¸€ä¸ªâ€œæ‰“å¼€ç›´é“¾â€çš„é€‰é¡¹æœ€ç¨³å¦¥
        // åªæœ‰åœ¨ç”¨æˆ·çœŸçš„çœ‹ä¸åˆ°å†…å®¹æ—¶æ‰ä¼šä½¿ç”¨
        // â€”â€” è‹¥ä½ çœ‹åˆ°ä»æ˜¯ç©ºç™½ï¼Œç‚¹â€œç›´æ¥é–‹ãâ€ï¼Œç¡®è®¤æ–‡ä»¶æ²¡é—®é¢˜
      }, 800);
    }

    // ===== é˜²ä¸‹è½½/æ‰“å°ï¼ˆå°½åŠ›è€Œä¸ºï¼Œæ— æ³•ç»å¯¹é˜²æ­¢ï¼‰=====
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('dragstart', e => e.preventDefault());
    document.addEventListener('keydown', e => {
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'p') {
        e.preventDefault();
        alert('å°åˆ·ã¯ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ã€‚');
      }
    });
    document.addEventListener('copy', e => {
      e.preventDefault();
      alert('ã‚³ãƒ”ãƒ¼ã¯ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ã€‚');
    });

    // å¦‚æœç”¨æˆ·åé¦ˆâ€œè¿˜æ˜¯ç©ºç™½â€ï¼Œè‡ªåŠ¨å±•ç¤ºé™çº§æŒ‰é’®
    // ï¼ˆç»™ä¸ªä¿åº•çš„æ‰‹åŠ¨è§¦å‘ï¼šåŒå‡»é¡µé¢ç©ºç™½å¤„å¼¹å‡ºç›´é“¾ï¼‰
    document.addEventListener('dblclick', () => {
      if (path) showFallback(path);
    });
  </script>
</body>
</html>
