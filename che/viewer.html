<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>è¬›ç¾©ãƒ•ã‚¡ã‚¤ãƒ«é–²è¦§ï½œå­¦ç¿’å°å±‹</title>
  <link rel="stylesheet" href="../common/style.css" />
  <style>
    html, body { height:100%; width:100%; margin:0; background:#000; overflow:hidden; }
    .overlay { position:fixed; top:14px; left:14px; z-index:10; }
    .btn { display:inline-block; padding:8px 14px; border:1px solid #fff; border-radius:8px; color:#fff; text-decoration:none; font-size:14px; background:rgba(255,255,255,.08); }
    #pdfFrame { width:100vw; height:100vh; border:none; background:#fff; }
    #fallback { position:fixed; inset:0; display:none; align-items:center; justify-content:center; text-align:center; color:#fff; background:rgba(0,0,0,.6); z-index:20; padding:24px; }
    #fallback .btn { border-color:#4a90e2; background:#4a90e2; margin-top:12px; }
  </style>
</head>
<body>
  <div class="overlay"><a id="backBtn" class="btn">â† ä¸€è¦§ã«æˆ»ã‚‹</a></div>
  <iframe id="pdfFrame" title="PDF Viewer"></iframe>
  <div id="fallback"><div><div style="font-size:1.05rem; margin-bottom:8px;">PDF ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</div><a id="openDirect" class="btn" target="_self">ğŸ“„ ç›´æ¥é–‹ã</a></div></div>

  <script>
    // â€”â€” æ˜ å°„è¡¨ï¼ˆç›¸å¯¹ /che/viewer.html çš„è·¯å¾„ï¼›æ³¨æ„æ²¡æœ‰ ../ï¼‰â€”â€”
    const FILES = {
      '2507_1': 'assets/lectures/2507/chem_1.pdf',
      '2507_2': 'assets/lectures/2507/chem_2.pdf',
      '2507_3': 'assets/lectures/2507/chem_3.pdf',
      '2510_1': 'assets/lectures/2510/chem_1.pdf',
      '2510_2': 'assets/lectures/2510/chem_2.pdf',
      '2510_3': 'assets/lectures/2510/chem_3.pdf'
    };

    const qs = new URL(location.href).searchParams;
    const id = qs.get('id') || '';
    const path = FILES[id];

    const frame = document.getElementById('pdfFrame');
    const fallback = document.getElementById('fallback');
    const openDirect = document.getElementById('openDirect');
    const backBtn = document.getElementById('backBtn');

    // è¿”å›ç›®æ ‡ï¼šä¼˜å…ˆ referrerï¼Œå†çœ‹ id å‰ç¼€
    let back = './lectures.html';
    const ref = document.referrer || '';
    if (ref.includes('list-2507.html')) back = './list-2507.html';
    else if (ref.includes('list-2510.html')) back = './list-2510.html';
    else if (/^2507_/.test(id)) back = './list-2507.html';
    else if (/^2510_/.test(id)) back = './list-2510.html';
    backBtn.href = back;

    if (!path) {
      // æ— æœ‰æ•ˆæ–‡ä»¶ â†’ å›é€€
      fallback.style.display = 'flex';
      openDirect.href = back;
    } else {
      document.title = `è¬›ç¾©ãƒ•ã‚¡ã‚¤ãƒ« (${id})ï½œå­¦ç¿’å°å±‹`;
      openDirect.href = path;

      // === å…³é”®ä¿®å¤ï¼šæ‰‹æœºç«¯ç›´æ¥ç”¨ç›´é“¾æ‰“å¼€ï¼ˆå¤šé¡µæ­£å¸¸ï¼‰ ===
      const ua = navigator.userAgent || navigator.vendor || window.opera;
      const isMobile = /iPhone|iPad|iPod|Android/i.test(ua);
      if (isMobile) {
        // åŒé¡µè·³è½¬ï¼Œä½¿ç”¨ç³»ç»Ÿ PDF æŸ¥çœ‹å™¨
        location.replace(path);
      } else {
        // æ¡Œé¢ç«¯ä¿æŒå†…åµŒ
        frame.src = path;
        // å…œåº•ï¼šä¸ªåˆ«æµè§ˆå™¨æ’ä»¶é˜»æ­¢å†…åµŒæ—¶ï¼Œç»™â€œç›´æ¥æ‰“å¼€â€
        frame.addEventListener('error', () => (fallback.style.display = 'flex'));
        setTimeout(() => {
          if (!frame.contentDocument) fallback.style.display = 'flex';
        }, 1500);
      }
    }
  </script>
</body>
</html>
